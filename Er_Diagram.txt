erDiagram
    ROLES {
        int id PK
        string role_name UK
        string descripted
    }

    ADMIN {
        int id PK
        string username UK
        string email UK
        string hashed_password
        datetime created_at
        datetime updated_at
        string role_name FK
    }

    CUSTOMER {
        int id PK
        string username
        string email UK
        string phone_number
        string hashed_password
        string address
        datetime created_at
        datetime updated_at
        string status
        string role_name FK
    }

    SELLER {
        int id PK
        string username
        string email UK
        string phone_number UK
        string hashed_password
        string business_name
        string business_type
        string business_address
        string kyc_document_type
        bigint kyc_document_number
        string bank_account_name
        bigint bank_account_number
        string bank_name
        string bank_branch
        datetime created_at
        datetime updated_at
        string status
        boolean is_verified
        string role_name FK
    }

    PRODUCTS {
        int id PK
        string product_name
        string url_slug UK
        string product_category
        string description
        string image_url
        string status
        int seller_id FK
        datetime created_at
        datetime updated_at
    }

    PRODUCT_VARIANTS {
        int id PK
        int product_id FK
        string sku UK
        string color
        string size
        decimal price
        int stock_quantity
        boolean is_active
        datetime created_at
        datetime updated_at
    }

    PRODUCT_IMAGES {
        int id PK
        int product_id FK
        string image_url
        boolean is_primary
        int sort_order
        datetime created_at
    }
    CARTS {
        int id PK
        int buyer_id FK
        string status
        datetime created_at
        datetime updated_at
    }

    CART_ITEMS {
        int id PK
        int cart_id FK
        int variant_id FK
        int quantity
        datetime created_at
        datetime updated_at
    }

    ORDERS {
        int id PK
        int buyer_id FK
        string status
        decimal total_price
        decimal shipping_fee
        decimal discount_amount
        decimal tax_amount
        datetime order_placed
        datetime delivered_at
    }

    ORDER_ITEMS {
        int id PK
        int order_id FK
        int variant_id FK
        int quantity
        decimal unit_price_snapshot
        decimal line_total
    }

    PAYMENTS {
        int id PK
        int order_id FK
        string method
        string status
        decimal amount
        string provider_ref
        datetime created_at
        datetime updated_at
    }

    ADDRESSES {
        int id PK
        int customer_id FK
        string full_name
        string phone_number
        string province
        string city
        string street
        string postal_code
        boolean is_default
        datetime created_at
        datetime updated_at
    }

    SHIPMENTS {
        int id PK
        int order_id FK
        string carrier
        string tracking_number
        string status
        datetime shipped_at
        datetime delivered_at
        datetime created_at
        datetime updated_at
    }

    SELLER_VERIFICATIONS {
        int id PK
        int seller_id FK
        string status
        int reviewed_by_admin_id FK
        string review_note
        datetime created_at
        datetime updated_at
    }

    PRODUCT_APPROVALS {
        int id PK
        int product_id FK
        string status
        int reviewed_by_admin_id FK
        string reason
        datetime created_at
        datetime updated_at
    }

    AUDIT_LOGS {
        int id PK
        string actor_type
        int actor_id
        string action
        string entity_type
        int entity_id
        string metadata_json
        datetime created_at
    }


    %% Role relationships
    ROLES ||--o{ ADMIN : "role_name"
    ROLES ||--o{ CUSTOMER : "role_name"
    ROLES ||--o{ SELLER : "role_name"

    %% Commerce relationships
    CUSTOMER ||--o{ ORDERS : "places"
    ORDERS ||--o{ ORDER_ITEM : "contains"
    PRODUCTS ||--o{ ORDER_ITEM : "included_in"
    SELLER ||--o{ PRODUCTS : "lists"

    %% Reviews
    PRODUCTS ||--o{ REVIEW : "receives"
    CUSTOMER ||--o{ REVIEW : "writes"

    %% Note: REFRESH_TOKENS.owner_id is polymorphic (Admin/Seller/Customer),
    %% so it has no enforced FK relationship in the schema.
